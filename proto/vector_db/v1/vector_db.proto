// File: proto/vector_db/v1/vector_db.proto
// Defines a provider-agnostic interface for a vector database service.
syntax = "proto3";

package vector_db.v1;

import "common/v1/common.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/spounge-ai/spounge-protos/gen/go/vector_db/v1;vectordbv1";

// A single vector with its ID and metadata.
message Vector {
  string id = 1;
  repeated float values = 2;
  // Arbitrary metadata associated with the vector.
  google.protobuf.Struct metadata = 3;
}

// A result from a similarity search query.
message QueryResult {
  string id = 1;
  float score = 2;
  google.protobuf.Struct metadata = 3;
}

// Request to add or update vectors in a collection.
message UpsertRequest {
  // The collection to upsert into.
  string collection_name = 1;
  repeated Vector vectors = 2;
}

message UpsertResponse {
  common.v1.Status status = 1;
  int32 upserted_count = 2;
}

// Request to query a collection for similar vectors.
message QueryRequest {
  string collection_name = 1;
  // The vector to find neighbors for.
  repeated float query_vector = 2;
  // The number of results to return.
  int32 top_k = 3;
  // Optional filter to apply to the search.
  optional google.protobuf.Struct filter = 4;
}

message QueryResponse {
  common.v1.Status status = 1;
  repeated QueryResult results = 2;
}

// VectorDBService is an internal service for RAG, typically called by PolykeyService.
service VectorDBService {
  rpc Upsert(UpsertRequest) returns (UpsertResponse) {}
  rpc Query(QueryRequest) returns (QueryResponse) {}
}